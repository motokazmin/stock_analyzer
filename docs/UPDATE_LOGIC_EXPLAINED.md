# ๐ ะะฐะบ ัะฐะฑะพัะฐะตั ะปะพะณะธะบะฐ ะพะฑะฝะพะฒะปะตะฝะธั

## โ ะะพะฟัะพั
ะัะธ ะบะฐะถะดะพะผ ะพะฑะฝะพะฒะปะตะฝะธะธ ะบะฐัะฐะตั ะะกะ ะดะฐะฝะฝัะต ะทะฐะฝะพะฒะพ + ะฝะพะฒัะต?

## โ ะัะฒะตั: ะะะข (ั ะพะณะพะฒะพัะบะฐะผะธ)

ะัะพัะตัั ะฝะตะผะฝะพะณะพ ัะปะพะถะฝะตะต. ะะฐะฒะฐะนัะต ัะฐะทะฑะตัะตะผัั:

---

## ๐ ะกัะตะฝะฐัะธะน 1: ะะะะะะ ะพะฑะฝะพะฒะปะตะฝะธะต

```
ะะพะผะฐะฝะดะฐ: python main.py update

1. ะัะพะฒะตััะตะผ ัััะตััะฒัะตั ะปะธ ัะฐะนะป SBER_full.csv?
   โ ะะะข
   
2. ะกะธััะตะผะฐ ะพะฟัะตะดะตะปัะตั from_date:
   from_date = ะกะะะะะะฏ - 365 ะดะฝะตะน
   
3. API ะทะฐะฟัะพั:
   GET /api/history?start=0&limit=100 (ะฝะตั ะฟะฐัะฐะผะตััะฐ from_date!)
   ะะตะทัะปััะฐั: ะะกะ ะดะฐะฝะฝัะต (ะฟัะธะผะตั: 1277 ะทะฐะฟะธัะตะน ะทะฐ ะฒัั ะธััะพัะธั)
   
4. ะคะธะปััััะตะผ ะฒ Python:
   df = df[df['DATE'] >= from_date]  โ ะพััะฐะฒะปัะตะผ ัะพะปัะบะพ ะทะฐ 365 ะดะฝะตะน
   ะะตะทัะปััะฐั: ~250 ะทะฐะฟะธัะตะน (ะฝะฐะฟัะธะผะตั)
   
5. ะกะพััะฐะฝัะตะผ:
   SBER_full.csv ัะพััะฐะฝะตะฝ ั 250 ะทะฐะฟะธััะผะธ
```

**ะงัะพ ะฑัะปะพ ัะบะฐัะฐะฝะพ:** 1277 ะทะฐะฟะธัะตะน  
**ะงัะพ ัะพััะฐะฝะตะฝะพ:** 250 ะทะฐะฟะธัะตะน  

---

## ๐ ะกัะตะฝะฐัะธะน 2: ะะขะะะะ ะพะฑะฝะพะฒะปะตะฝะธะต (ัะตัะตะท ะดะตะฝั)

```
ะะพะผะฐะฝะดะฐ: python main.py update (ะทะฐะฟัััะธะปะธ 13.11, ะฟะพัะพะผ 14.11)

1. ะัะพะฒะตััะตะผ ัััะตััะฒัะตั ะปะธ ัะฐะนะป SBER_full.csv?
   โ ะะ
   
2. ะกะธััะตะผะฐ ัะธัะฐะตั ะฟะพัะปะตะดะฝัั ะดะฐัั ะธะท ัะฐะนะปะฐ:
   last_date = 2025-11-13 (ะธะท CSV)
   from_date = 2025-11-14 (ะฟะพัะปะตะดะฝัั + 1 ะดะตะฝั)
   
3. API ะทะฐะฟัะพั:
   GET /api/history?start=0&limit=100 (from_date ะฝะต ัะฐะฑะพัะฐะตั ะฒ API!)
   ะะตะทัะปััะฐั: ะะกะ ะดะฐะฝะฝัะต (ะพะฟััั 1277 ะทะฐะฟะธัะตะน!)
   
4. ะคะธะปััััะตะผ ะฒ Python:
   df = df[df['DATE'] >= 2025-11-14]
   ะะตะทัะปััะฐั: 1 ะทะฐะฟะธัั (ะดะฐะฝะฝัะต ะทะฐ 14.11) ะธะปะธ 0 (ะตัะปะธ ะฒััะพะดะฝะพะน)
   
5. ะะฑัะตะดะธะฝัะตะผ ัะพ ััะฐััะผะธ ะดะฐะฝะฝัะผะธ:
   existing_data (250 ะทะฐะฟะธัะตะน) + new_data (1 ะทะฐะฟะธัั) 
   = merged_data (251 ะทะฐะฟะธัั)
   
6. ะกะพััะฐะฝัะตะผ:
   SBER_full.csv ะฟะตัะตะทะฐะฟะธัะฐะฝ ั 251 ะทะฐะฟะธััั
```

**ะงัะพ ะฑัะปะพ ัะบะฐัะฐะฝะพ:** 1277 ะทะฐะฟะธัะตะน (ะฒัั ะทะฐะฝะพะฒะพ!)  
**ะะท ะฝะธั ะธัะฟะพะปัะทะพะฒะฐะฝะพ:** 1 ะทะฐะฟะธัั (ะฝะพะฒะฐั)  
**ะััะฐะปัะฝะพะต:** ะฒัะฑัะพัะตะฝะพ  

---

## โ๏ธ ะะะะะะะะ

โ **ะะฐะถะดัะน ัะฐะท ัะบะฐัะธะฒะฐะตะผ ะะกะ 1277 ะทะฐะฟะธัะตะน, ัะพัั ะฝัะถะฝะฐ ัะพะปัะบะพ 1 ะฝะพะฒะฐั**

```
ะะตัะฒะพะต ะพะฑะฝะพะฒะปะตะฝะธะต: 1277 ะทะฐะฟะธัะตะน โ ะพััะธะปัััะพะฒะฐะฝะพ โ 250 ัะพััะฐะฝะตะฝะพ
ะัะพัะพะต ะพะฑะฝะพะฒะปะตะฝะธะต: 1277 ะทะฐะฟะธัะตะน โ ะพััะธะปัััะพะฒะฐะฝะพ โ 1 ะธัะฟะพะปัะทะพะฒะฐะฝะพ
ะขัะตััะต ะพะฑะฝะพะฒะปะตะฝะธะต: 1277 ะทะฐะฟะธัะตะน โ ะพััะธะปัััะพะฒะฐะฝะพ โ 1 ะธัะฟะพะปัะทะพะฒะฐะฝะพ
```

**ะญัะพ ะฝะตัััะตะบัะธะฒะฝะพ, ะฝะพ:**
- โฑ๏ธ ะัะตะผั ะทะฐะณััะทะบะธ: ~2 ัะตะบัะฝะดั ะฝะฐ ะพะดะฝั ะฐะบัะธั (ะฟัะธะตะผะปะตะผะพ)
- ๐ ะะปั ะดะฝะตะฒะฝะพะณะพ ะพะฑะฝะพะฒะปะตะฝะธั ััะพ ะฝะพัะผะฐะปัะฝะพ
- ๐ ะะฐะฝะฝัะต ะฒัั ัะฐะฒะฝะพ ะบะพััะตะบัะฝัะต

---

## ๐ง ะะะจะะะะ: ะะฒััััะพะฒะฝะตะฒะพะต ะบะตัะธัะพะฒะฐะฝะธะต

### ะะฐัะธะฐะฝั 1: ะะะขะะะะะะะะะะะะะ ะพะฑะฝะพะฒะปะตะฝะธะต (ะะะะะะะะะฃะะขะกะฏ)

```python
# ะัะพะฒะตััะตะผ ะดะฐัั ะฟะพัะปะตะดะฝะตะณะพ ะพะฑะฝะพะฒะปะตะฝะธั ะฒ ะผะตัะฐะดะฐะฝะฝัั
meta = ConfigManager.get_setting('last_api_fetch_date')

if (TODAY - meta['last_date']).days < 1:
    # ะัะพัะปะพ ะผะตะฝะตะต 1 ะดะฝั - ะฑะตัะตะผ ะธะท ะบะตัะฐ
    logger.info("ะัะฟะพะปัะทัะตะผ ะบะตัะธัะพะฒะฐะฝะฝัะต ะดะฐะฝะฝัะต")
    new_data = cached_data
else:
    # ะัะพัะปะพ ะฑะพะปะตะต 1 ะดะฝั - ะบะฐัะฐะตะผ ัะฒะตะถะธะต
    logger.info("ะะฑะฝะพะฒะปัะตะผ ะดะฐะฝะฝัะต ั API")
    new_data = api.fetch()
```

### ะะฐัะธะฐะฝั 2: ะฃะผะฝัะน ะธะฝะบัะตะผะตะฝัะฐะปัะฝัะน ัะบะฐัะธะฒะฐะฝะธะต

```python
# ะะผะตััะพ: GET /api/history?start=0&limit=100000
# ะัะฟะพะปัะทัะตะผ: GET /api/history?from={last_date}&to=today

# ะะพ API ะะพัะฑะธัะถะธ ะฝะต ะฟะพะดะดะตัะถะธะฒะฐะตั ััะพ :(
# ะัะถะฝะพ ัะฐะฑะพัะฐัั ั ัะตะผ ััะพ ะตััั
```

---

## ๐ ะะะะะขะะงะะกะะะ ะกะะะะข

### ะัะปะธ ะพะฑะฝะพะฒะปัะตัะต ะงะะกะขะ (ะบะฐะถะดัะน ัะฐั/ะดะตะฝั):
```bash
# ะะตะฝั 1 (ะฟะตัะฒัะน ัะฐะท)
python main.py update  # ~5 ัะตะบ ะฝะฐ 22 ะฐะบัะธะธ

# ะะตะฝั 2 
python main.py update  # ~5 ัะตะบ (ะบะฐัะฐะตั ะฒัั, ะฝะพ ัะธะปััััะตั)

# ะะตะฝั 3, 4, 5...
python main.py update  # ~5 ัะตะบ ะบะฐะถะดัะน ัะฐะท
```

**ะญัะพ ะฝะพัะผะฐะปัะฝะพ!** 5 ัะตะบัะฝะด ะฒ ะดะตะฝั - ะฟัะธะตะผะปะตะผะพ.

### ะัะปะธ ะพะฑะฝะพะฒะปัะตัะต ะะะะะ (ัะฐะท ะฒ ะฝะตะดะตะปั):
```bash
# ะะตะดะตะปั 1
python main.py update  # ~5 ัะตะบ, 7 ะดะฝะตะน ะดะฐะฝะฝัั

# ะะตะดะตะปั 2
python main.py update  # ~5 ัะตะบ, 7 ะดะฝะตะน ะดะฐะฝะฝัั
```

**ะญัะพ ัะพะถะต ะฝะพัะผะฐะปัะฝะพ!**

---

## ๐ฏ ะะะขะะะะะฌะะ ะะะฏ ะะะจะะ ะกะะกะขะะะซ

### ะขะตะบััะตะต ะฟะพะฒะตะดะตะฝะธะต:
```
ะะฐะถะดะพะต ะพะฑะฝะพะฒะปะตะฝะธะต:
1. ะงะธัะฐะตั ะฟะพัะปะตะดะฝัั ะดะฐัั ะธะท CSV โ
2. ะะฐะณััะถะฐะตั ะฒัั ะธััะพัะธั ั API โ๏ธ (ะฝะตัััะตะบัะธะฒะฝะพ)
3. ะคะธะปััััะตั ะฟะพ ะดะฐัะต โ
4. ะะฑัะตะดะธะฝัะตั ั ัััะตััะฒัััะธะผะธ ะดะฐะฝะฝัะผะธ โ
5. ะกะพััะฐะฝัะตั ะฒ CSV โ
```

### ะะตะบะพะผะตะฝะดะฐัะธั: ะะกะขะะะะขะฌ ะะะ ะะกะขะฌ

ะัะธัะธะฝั:
- โ API ะฝะต ะฟะพะดะดะตัะถะธะฒะฐะตั ัะธะปััั ะฟะพ ะดะฐัะฐะผ
- โ 5 ัะตะบัะฝะด ะฝะฐ ะพะฑะฝะพะฒะปะตะฝะธะต ะฟัะธะตะผะปะตะผะพ
- โ ะะฐะฝะฝัะต ะะกะะะะ ะบะพััะตะบัะฝัะต (ะฟะพะปะฝัะน ะฟะตัะตััะตั)
- โ ะัะพััะพัะฐ ะธ ะฝะฐะดะตะถะฝะพััั

---

## ๐ ะกะฅะะะ ะะะะฆะะกะกะ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ python main.py update                         โ
โโโโโโโโโโโโโโโโโโโโโโโคโโโโโโโโโโโโโโโโโโโโโโโโโโ
                      โ
        โโโโโโโโโโโโโโโดโโโโโโโโโโโโโโ
        โผ                           โผ
   โโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโ
   โ CSV ัััะตััะฒัะตั?     โ CSV ะะ ัััะตััะฒัะตั
   โโโโโโโโฌโโโโโโโ         โโโโโโโโโโฌโโโโโโ
          โ                         โ
      โ ะะ                     โ ะะะข
          โ                         โ
          โผ                         โผ
    โโโโโโโโโโโโโโโโ       โโโโโโโโโโโโโโโโโโโโ
    โ ะงะธัะฐะตะผ       โ       โ last_date = NULL โ
    โ last_date    โ       โ from_date =      โ
    โ ะธะท CSV       โ       โ 365 ะดะฝะตะน ะฝะฐะทะฐะด   โ
    โโโโโโโโฌโโโโโโโโ       โโโโโโโโโโฌโโโโโโโโโโ
           โ                         โ
           โโโโโโโโโโโโโโโฌโโโโโโโโโโโโค
           โ             โ           โ
           โผ             โผ           โผ
       โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
       โ API.fetch(history)               โ
       โ ะะพะปััะฐะตะผ: 1277 ะทะฐะฟะธัะตะน           โ
       โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโ
                    โ
                    โผ
          โโโโโโโโโโโโโโโโโโโโโโ
          โ ะคะธะปััััะตะผ          โ
          โ df['DATE'] >= from โ
          โโโโโโโโโโโฌโโโโโโโโโโโ
                    โ
        โโโโโโโโโโโโโดโโโโโโโโโโโโ
        โผ                       โผ
    NEW (1-10)            REMOVE (1267)
    
        โ                       โ
        โ                   (ะฒัะฑัะพัะธัั)
        โ
        โโ ะัะปะธ first time:
        โ  โโ merged = NEW
        โ
        โโ ะัะปะธ update:
           โโ merged = OLD + NEW (ะพะฑัะตะดะธะฝะธัั)
                    โ
                    โผ
            โโโโโโโโโโโโโโโโโ
            โ ะกะพััะฐะฝะธัั     โ
            โ CSV           โ
            โโโโโโโโโโโโโโโโโ
```

---

## ๐ก ะะขะะะะะซะ ะะขะะะข

**ะะพะฟัะพั:** "ะัะธ ะบะฐะถะดะพะผ ะพะฑะฝะพะฒะปะตะฝะธะธ ะบะฐัะฐะตั ะะกะ ะดะฐะฝะฝัะต ะทะฐะฝะพะฒะพ + ะฝะพะฒัะต?"

**ะัะฒะตั:**
- ๐ด ะะฐ, **ะบะฐัะฐะตั** ะะกะ ะดะฐะฝะฝัะต (1277 ะทะฐะฟะธัะตะน)
- ๐ข ะะพ **ะธัะฟะพะปัะทัะตั** ัะพะปัะบะพ ะฝะพะฒัะต (1-10 ะทะฐะฟะธัะตะน)
- ๐ข **ะกะพััะฐะฝัะตั** ะพะฑัะตะดะธะฝัะฝะฝัะน ัะฐะนะป (ััะฐััะต + ะฝะพะฒัะต)
- ๐ก **ะะตัััะตะบัะธะฒะฝะพ ะฟะพ ััะฐัะธะบั**, ะฝะพ:
  - ะััััะพ (~5 ัะตะบ ะฝะฐ 22 ะฐะบัะธะธ)
  - ะะฐะดะตะถะฝะพ (ะฟะพะปะฝัะน ะฟะตัะตััะตั)
  - ะัะพััะพะน ะบะพะด

### ะัะปะธ ัะพัะธัะต ะพะฟัะธะผะธะทะธัะพะฒะฐัั:
ะัะถะฝะพ ะธัะฟะพะปัะทะพะฒะฐัั ะดััะณะพะน ะธััะพัะฝะธะบ API, ะบะพัะพััะน ะฟะพะดะดะตัะถะธะฒะฐะตั ัะธะปััั ะฟะพ ะดะฐัะฐะผ.
ะะพ ะดะปั ัะตะบััะตะน ะทะฐะดะฐัะธ - ััะพ ะฝะพัะผะฐะปัะฝะพ! โ

