# üèóÔ∏è ARCHITECTURE - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã Stock Analyzer

–û–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–æ–¥—É–ª–µ–π.

## üìä –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨                             ‚îÇ
‚îÇ              (CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —á–µ—Ä–µ–∑ main.py)                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
                     ‚ñº
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ      main.py (CLI)         ‚îÇ ‚≠ê –í—Ö–æ–¥–Ω–∞—è —Ç–æ—á–∫–∞
        ‚îÇ  ‚Ä¢ parse arguments         ‚îÇ   ‚Ä¢ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã
        ‚îÇ  ‚Ä¢ route commands          ‚îÇ   ‚Ä¢ –£–ø—Ä–∞–≤–ª—è–µ—Ç workflow
        ‚îÇ  ‚Ä¢ handle errors           ‚îÇ   ‚Ä¢ –í—ã–≤–æ–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        ‚îî‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îò
            ‚îÇ          ‚îÇ          ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ config  ‚îÇ  ‚îÇ command  ‚îÇ  ‚îÇ  error handling    ‚îÇ
    ‚îÇ manager ‚îÇ  ‚îÇ routing  ‚îÇ  ‚îÇ  & logging         ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  LAYER 1: CONFIGURATION & STATE              ‚îÇ
    ‚îÇ  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê  ‚îÇ
    ‚îÇ  ‚Ä¢ config_manager.py                         ‚îÇ
    ‚îÇ    - Load/save config                        ‚îÇ
    ‚îÇ    - Manage watchlist                        ‚îÇ
    ‚îÇ    - Get/set parameters                      ‚îÇ
    ‚îÇ    - Key levels management                   ‚îÇ
    ‚îÇ  ‚Ä¢ config.json                               ‚îÇ
    ‚îÇ    - Watchlist                               ‚îÇ
    ‚îÇ    - Analysis parameters                     ‚îÇ
    ‚îÇ    - Trading rules                           ‚îÇ
    ‚îÇ    - Folder paths                            ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  LAYER 2: DATA ACQUISITION & STORAGE          ‚îÇ
    ‚îÇ  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ‚îÇ
    ‚îÇ  ‚Ä¢ stock_data_manager.py                      ‚îÇ
    ‚îÇ    - Download from Moex ISS API               ‚îÇ
    ‚îÇ    - Save to CSV                              ‚îÇ
    ‚îÇ    - Load from CSV                            ‚îÇ
    ‚îÇ    - Get statistics                           ‚îÇ
    ‚îÇ  ‚Ä¢ stock_data/ folder                         ‚îÇ
    ‚îÇ    - SBER_full.csv                            ‚îÇ
    ‚îÇ    - GAZP_full.csv                            ‚îÇ
    ‚îÇ    - ... (one file per ticker)                ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  LAYER 3: ANALYSIS & INDICATORS               ‚îÇ
    ‚îÇ  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ‚îÇ
    ‚îÇ  ‚Ä¢ technical_analysis.py                      ‚îÇ
    ‚îÇ    - Calculate EMA                            ‚îÇ
    ‚îÇ    - Calculate RSI                            ‚îÇ
    ‚îÇ    - Find S/R levels                          ‚îÇ
    ‚îÇ    - Detect trend                             ‚îÇ
    ‚îÇ    - Analyze volumes                          ‚îÇ
    ‚îÇ    - Full analysis                            ‚îÇ
    ‚îÇ  ‚Ä¢ Result: Dict with indicators               ‚îÇ
    ‚îÇ    - Price data                               ‚îÇ
    ‚îÇ    - Technical indicators                     ‚îÇ
    ‚îÇ    - Trend information                        ‚îÇ
    ‚îÇ    - Volume profile                           ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  LAYER 4: REPORTING & SIGNALS                 ‚îÇ
    ‚îÇ  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ‚îÇ
    ‚îÇ  ‚Ä¢ report_generator.py                        ‚îÇ
    ‚îÇ    - Rank stocks by score                     ‚îÇ
    ‚îÇ    - Generate signals                         ‚îÇ
    ‚îÇ    - Create markdown reports                  ‚îÇ
    ‚îÇ    - Save reports                             ‚îÇ
    ‚îÇ  ‚Ä¢ reports/ folder                            ‚îÇ
    ‚îÇ    - report_20240113_101530.md                ‚îÇ
    ‚îÇ    - (one file per analysis run)              ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ         OUTPUT TO USER                      ‚îÇ
    ‚îÇ  ‚Ä¢ Console messages                         ‚îÇ
    ‚îÇ  ‚Ä¢ Report file (ready to send)              ‚îÇ
    ‚îÇ  ‚Ä¢ Updated config.json                      ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üîÑ Data Flow Diagrams

### Workflow: `python main.py update`

```
main.py (update command)
    ‚îÇ
    ‚îú‚îÄ> config_manager.load_config()
    ‚îÇ   ‚îî‚îÄ> Returns: watchlist = ['SBER', 'GAZP', ...]
    ‚îÇ
    ‚îú‚îÄ> stock_data_manager.update_watchlist(watchlist)
    ‚îÇ   ‚îú‚îÄ> For each ticker:
    ‚îÇ   ‚îÇ   ‚îú‚îÄ> analyzer.download_stock_data(ticker)
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ> Calls: https://iss.moex.com/.../SBER.json
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ> Parse JSON response
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ> Returns: DataFrame
    ‚îÇ   ‚îÇ   ‚îÇ
    ‚îÇ   ‚îÇ   ‚îî‚îÄ> save_to_csv(ticker, data)
    ‚îÇ   ‚îÇ       ‚îî‚îÄ> Saves: stock_data/SBER_full.csv
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îî‚îÄ> Returns: {ticker: success_bool, ...}
    ‚îÇ
    ‚îî‚îÄ> config_manager.update_last_updated()
        ‚îî‚îÄ> Updates: config.json (last_updated = now)
```

### Workflow: `python main.py analyze`

```
main.py (analyze command)
    ‚îÇ
    ‚îú‚îÄ> config_manager.get_watchlist()
    ‚îÇ   ‚îî‚îÄ> Returns: ['SBER', 'GAZP', ...]
    ‚îÇ
    ‚îú‚îÄ> For each ticker:
    ‚îÇ   ‚îú‚îÄ> technical_analyzer.analyze_stock(ticker)
    ‚îÇ   ‚îÇ   ‚îú‚îÄ> Load: stock_data/SBER_full.csv
    ‚îÇ   ‚îÇ   ‚îú‚îÄ> Calculate EMA (20, 50, 200)
    ‚îÇ   ‚îÇ   ‚îú‚îÄ> Calculate RSI (14)
    ‚îÇ   ‚îÇ   ‚îú‚îÄ> Find support/resistance
    ‚îÇ   ‚îÇ   ‚îú‚îÄ> Detect trend
    ‚îÇ   ‚îÇ   ‚îú‚îÄ> Calculate volume profile
    ‚îÇ   ‚îÇ   ‚îî‚îÄ> Returns: {indicators: {...}, trend: {...}, ...}
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îî‚îÄ> Collect all results
    ‚îÇ
    ‚îú‚îÄ> report_generator.generate_and_save(tickers)
    ‚îÇ   ‚îú‚îÄ> rank_stocks(results)
    ‚îÇ   ‚îÇ   ‚îî‚îÄ> Calculate score for each stock
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îú‚îÄ> find_signals(results)
    ‚îÇ   ‚îÇ   ‚îî‚îÄ> Generate üü¢/üü°/üî¥ signals
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îú‚îÄ> generate_detailed_analysis()
    ‚îÇ   ‚îÇ   ‚îî‚îÄ> For each stock
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îú‚îÄ> save_report(report_text)
    ‚îÇ   ‚îÇ   ‚îî‚îÄ> Saves: reports/report_TIMESTAMP.md
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îî‚îÄ> Returns: filepath
    ‚îÇ
    ‚îî‚îÄ> config_manager.update_last_report()
        ‚îî‚îÄ> Updates: config.json (last_report = now)
```

## üîå Module Dependencies

```
        main.py
          ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ     ‚îÇ     ‚îÇ
    ‚ñº     ‚ñº     ‚ñº
config  stock  report
_mgr    _data  _gen
 ‚îÇ      _mgr    ‚îÇ
 ‚îÇ       ‚îÇ      ‚îÇ
 ‚ñº       ‚ñº      ‚ñº
 ‚îÇ   technical
 ‚îÇ   _analysis
 ‚îÇ       ‚îÇ
 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
      config
      .json
```

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- `main.py` –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
- `report_generator.py` –∑–∞–≤–∏—Å–∏—Ç –æ—Ç `technical_analysis.py`
- `stock_data_manager.py` –Ω–µ–∑–∞–≤–∏—Å–∏–º
- `technical_analysis.py` –Ω–µ–∑–∞–≤–∏—Å–∏–º
- `config_manager.py` —á–∏—Ç–∞–µ—Ç `config.json`

## üìÅ File Organization

### Input Files

```
config.json          Configuration
‚îú‚îÄ‚îÄ watchlist        What to analyze
‚îú‚îÄ‚îÄ folders          Where to store data
‚îú‚îÄ‚îÄ analysis         Analysis parameters
‚îú‚îÄ‚îÄ key_levels       Manual S/R levels
‚îú‚îÄ‚îÄ trading          Trading rules
‚îî‚îÄ‚îÄ settings         App settings
```

### Data Files (Auto-Generated)

```
stock_data/          CSV files with price data
‚îú‚îÄ‚îÄ SBER_full.csv    (downloaded from API)
‚îú‚îÄ‚îÄ GAZP_full.csv    (downloaded from API)
‚îî‚îÄ‚îÄ ...

reports/             Generated reports
‚îú‚îÄ‚îÄ report_20240113_101530.md
‚îú‚îÄ‚îÄ report_20240114_101530.md
‚îî‚îÄ‚îÄ ...

logs/                Application logs
‚îî‚îÄ‚îÄ stock_data_manager.log
```

## üîÑ Data Structures

### config.json Structure

```json
{
  "app": {...},                    // App info
  "watchlist": [array of tickers], // What to monitor
  "folders": {...},                // Where to store data
  "analysis": {...},               // Analysis parameters
  "key_levels": {                  // Manual levels per stock
    "SBER": {"support": [...], "resistance": [...]}
  },
  "trading": {...},                // Trading parameters
  "reporting": {...},              // Report settings
  "last_updated": ISO_timestamp,   // Last update time
  "last_report": ISO_timestamp     // Last report time
}
```

### Analysis Result Structure

```python
{
  'ticker': 'SBER',
  'data_points': 252,
  'date_from': '2023-11-13',
  'date_to': '2024-11-13',
  'current_price': 105.50,
  'price_change': 5.50,
  'price_change_pct': 5.50,
  
  'technical_indicators': {
    'ema_20': 104.30,
    'ema_50': 103.20,
    'ema_200': 102.10,
    'rsi': 45.5,
    'rsi_signal': 'neutral'
  },
  
  'support_resistance': {
    'support': 100.50,
    'resistance': 110.50,
    'support_levels_count': 12,
    'resistance_levels_count': 8
  },
  
  'trend': {
    'trend': 'up',
    'strength': 'strong',
    'above_ma20': True,
    'above_ma50': True,
    'angle': 0.45
  },
  
  'volume': {
    'total_volume': 1250000000,
    'avg_volume': 8500000,
    'point_of_control': 105.50,
    'volume_trend': 'increasing'
  }
}
```

### Report Structure

```markdown
# –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∞–∫—Ü–∏–π

## üèÜ –†–µ–π—Ç–∏–Ω–≥ –∞–∫—Ü–∏–π (—Ç–∞–±–ª–∏—Ü–∞)
| –¢–∏–∫–µ—Ä | –¶–µ–Ω–∞ | –°–∏–≥–Ω–∞–ª | –°–∫–æ—Ä | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |

## üìä –ì–ª–∞–≤–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã
### üü¢ –ü–û–ö–£–ü–ö–ê
### üü° –û–ñ–ò–î–ê–ù–ò–ï
### üî¥ –ü–†–û–î–ê–ñ–ê

## üìà –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
For each stock:
  - –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
  - –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–∞
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞/—Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ
  - –ê–Ω–∞–ª–∏–∑ –æ–±—ä—ë–º–æ–≤
  - –¢–æ—á–∫–∏ –≤—Ö–æ–¥–∞
  - –¶–µ–ª–∏ –ø—Ä–∏–±—ã–ª–∏
  - –°—Ç–æ–ø-–ª–æ—Å—Å
  - –í—ã–≤–æ–¥
```

## üîê Data Security

- **–í—Å—ë –ª–æ–∫–∞–ª—å–Ω–æ** - –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
- **–û—Ç–∫—Ä—ã—Ç—ã–µ –∏—Å—Ö–æ–¥–Ω–∏–∫–∏** - –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥
- **–ë–µ–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö** - —Ç–æ–ª—å–∫–æ –∑–∞–≥—Ä—É–∑–∫–∞ —Å API
- **–ù–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–π API –ú–æ—Å–±–∏—Ä–∂–∏

## üöÄ Performance

### –¢–∏–ø–∏—á–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–π

| –û–ø–µ—Ä–∞—Ü–∏—è | –í—Ä–µ–º—è | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç |
|----------|-------|-----------|
| –ó–∞–≥—Ä—É–∑–∫–∞ 1 –∞–∫—Ü–∏–∏ | 2-3 —Å–µ–∫ | –ò–Ω—Ç–µ—Ä–Ω–µ—Ç, API –ú–æ—Å–±–∏—Ä–∂–∏ |
| –ó–∞–≥—Ä—É–∑–∫–∞ 5 –∞–∫—Ü–∏–π | 10-15 —Å–µ–∫ | –ò–Ω—Ç–µ—Ä–Ω–µ—Ç |
| –ê–Ω–∞–ª–∏–∑ 1 –∞–∫—Ü–∏–∏ | 0.5 —Å–µ–∫ | –¶–ü–£ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ |
| –ê–Ω–∞–ª–∏–∑ 5 –∞–∫—Ü–∏–π | 2-3 —Å–µ–∫ | –¶–ü–£ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ |
| –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á—ë—Ç–∞ | 1-2 —Å–µ–∫ | –†–∞–∑–º–µ—Ä –æ—Ç—á—ë—Ç–∞ |
| **–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª (5 –∞–∫—Ü–∏–π)** | **15-20 —Å–µ–∫** | - |

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ CSV (–Ω–µ –Ω—É–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å –∑–∞–Ω–æ–≤–æ)
- –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–≤—Å–µ –∞–∫—Ü–∏–∏ —Å—Ä–∞–∑—É)
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ - –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –≤ –±—É–¥—É—â–µ–º

## üîÑ Extension Points

### –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä?

1. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –≤ `TechnicalAnalyzer`
2. –í—ã–∑–≤–∞—Ç—å –µ–≥–æ –≤ `analyze_stock()`
3. –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –æ—Ç—á—ë—Ç

```python
# –í technical_analysis.py
def calculate_macd(self, df, fast=12, slow=26):
    # Calculate MACD
    return df

# –í analyze_stock()
df = analyzer.calculate_macd(df)
result['indicators']['macd'] = df['MACD'].iloc[-1]
```

### –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å?

1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª —Å –∫–ª–∞—Å—Å–æ–º
2. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ `main.py`
3. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –≤ CLI
4. –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

## üìä API Integration

### –ú–æ—Å–±–∏—Ä–∂–∞ ISS API

```
URL: https://iss.moex.com/iss/history/engines/stock/markets/shares/securities/{ticker}.json

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
  - start: –Ω–∞—á–∞–ª–æ (–¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏)
  - limit: –∫–æ–ª-–≤–æ –∑–∞–ø–∏—Å–µ–π (–º–∞–∫—Å 100)

–û—Ç–≤–µ—Ç:
  {
    "history": {
      "columns": ["TRADEDATE", "OPEN", "HIGH", "LOW", "CLOSE", "VOLUME"],
      "data": [[date, open, high, low, close, volume], ...]
    }
  }

–û–±—Ä–∞–±–æ—Ç–∫–∞:
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä—ã –ø—Ä–∏ –æ—à–∏–±–∫–µ (3 —Ä–∞–∑–∞)
  - –¢–∞–π–º–∞—É—Ç: 10 —Å–µ–∫—É–Ω–¥
  - –ü–∞–∫–µ—Ç–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞: 100 –∑–∞–ø–∏—Å–µ–π –∑–∞ —Ä–∞–∑
```

## üß™ Testing

### –ú–æ–¥—É–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```
test_manager.py
‚îú‚îÄ‚îÄ Test 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Test 2: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ Test 3: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ CSV
‚îú‚îÄ‚îÄ Test 4: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚îî‚îÄ‚îÄ Test 5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞

–†–µ–∑—É–ª—å—Ç–∞—Ç: 5/5 ‚úì
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```
main.py commands
‚îú‚îÄ‚îÄ python main.py list
‚îú‚îÄ‚îÄ python main.py add GAZP
‚îú‚îÄ‚îÄ python main.py update
‚îú‚îÄ‚îÄ python main.py analyze
‚îú‚îÄ‚îÄ python main.py info SBER
‚îî‚îÄ‚îÄ python main.py status
```

## üîÆ Future Improvements

### v1.1.0 (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- [ ] –ö—ç—à –≤ –ø–∞–º—è—Ç–∏ (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞)
- [ ] –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∞–∫—Ü–∏–π
- [ ] Webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [ ] WebUI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### v2.0.0 (–∏–¥–µ–∏)
- [ ] SQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥—Ä—É–≥–∏—Ö –±–∏—Ä–∂
- [ ] Machine Learning –ø—Ä–æ–≥–Ω–æ–∑—ã
- [ ] Telegram –±–æ—Ç
- [ ] REST API

## üìû Architecture Documentation

–¢–µ–∫—É—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- `ARCHITECTURE.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª
- `README_FINAL.md` - –ø–æ–ª–Ω—ã–π –æ–±–∑–æ—Ä
- –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ - —Ö–æ—Ä–æ—à–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω

## ‚ú® Design Principles

1. **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** - –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–¥–Ω–æ
2. **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –ª–µ–≥–∫–æ –ø–æ–Ω—è—Ç—å –∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å
3. **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤–µ–∑–¥–µ
4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
5. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –≤—Å—ë –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ

---

**Stock Analyzer Architecture v1.0.0**

–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 13 –ù–æ—è–±—Ä—è 2024

